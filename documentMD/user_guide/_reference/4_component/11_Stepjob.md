# Stepjob

![img](./img/stepjob.png)

stepjob/stepjobTaskコンポーネントは、ジョブスケジューラ「FUJITSU Software Technical Computing Suite（TCS）」のステップジョブ機能に基づいた機能です。
ステップジョブを利用できるリモートホストが設定されている場合のみ使用することができます。

本機能は、stepjobコンポーネントとstepjobコンポーネント内でのみ使用できるstepjobTaskコンポーネントを組み合わせて使用します。

stepjobコンポーネントは特殊なworkflowコンポーネントとして機能し、
内部にはstepjobTaskコンポーネントのみを配置することができます。

stepjobtaskコンポーネントは実行順と依存関係式を指定することができます。
これらの設定に基づいてTCSのステップジョブ機能を用いてサブジョブとして投入されます。

ステップジョブ機能の詳細に関しては、ジョブスケジューラ「FUJITSU Software Technical Computing Suite（TCS）」のドキュメントをご確認ください。

Stepjob/StepjobTaskコンポーネントに設定できるプロパティは以下のとおりです。

## stepjob
###  host
taskコンポーネントと同様ですが、stepjob機能を利用できるリモートホストを設定する必要があります。

### useJobScheduler
デフォルトで有効になっており、無効に設定すると
プロジェクトが正常に実行されなくなります。

### queue
taskコンポーネントと同様、ジョブの投入先キューを設定します。

## stepjobtask
### script
バッチサーバに投入するジョブスクリプトを設定します。

### useDependency
有効にすると、次のdependencyFormを設定できるようになり、
そこで設定された依存関係式に従ってステップジョブが実行されます。

### step number
stepjobtaskの実行順を決める番号が設定されます。
この値はコンポーネント間の接続状況から、WHEELが自動的に計算して設定し
変更することはできません

### dependencyForm
ジョブ実行を行うにあたっての依存関係式を設定できます。

依存関係式は、実行済みstepjobTaskコンポーネントの
ジョブスクリプトの終了ステータス（ec)
もしくはジョブの終了コード(pc）にもとづいて
実行の可否を判断するための式です。

依存関係式の定義は次のとおりです。

```
sd=form[:[deletetype][:stepno[:stepno[...]]]]
```

| 式要素 | 説明 |
| ---- | ---- |
| sd= | 接頭辞、必須 |
| form | 投入するサブジョブを実行するかどうかを判断する条件を示す式 |
| deletetype | サブジョブを実行しない場合の詳細動作の指定 |
| stepno | どのサブジョブの実行結果に対して適用するかを示すステップナンバー |

#### form

formは、param(ec:依存するサブジョブのジョブスクリプトの終了コード, pc:依存するサブジョブのジョブ終了コード)と
値「==, !=, <, > , <=, >=」で指定します。
```
ex.
ec==0
```
条件==や!=を指定する場合、値はコンマ(,)で区切ることで複数指定できます。

#### deletetype
deletetypeは、以下の3種類指定できます。

| deletetype | 説明 |
| ---- | ---- |
| one | このサブジョブのみ削除する。このサブジョブの結果に依存する後続のサブジョブは削除されない |
| after | このサブジョブ、及びそれに依存する後続のサブジョブのみ削除する|
| all | このサブジョブ、及び後続のサブジョブを全て削除する |

以下にformプロパティに設定する依存関係式の例を示します。
```
ex.ステップナンバー0のサブジョブのジョブスクリプトの終了コードが0以外の場合、このサブジョブ以降は実行しない

sd=ec!=0:all:0
```

--------
[ページの先頭に戻る](#コンポーネントの詳細)
