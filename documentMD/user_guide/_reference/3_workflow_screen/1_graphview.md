# 1. グラフビュー画面
本章では、グラフビュー画面の機能について説明します。

ワークフローの作成・実行方法の具体例は、[チュートリアル](../../3_WHEEL_tutorial/index.md)をご参照ください

グラフビュー画面は以下のように構成されています。

![img](./img/workflow_graphview.png "workflow_graghview")

 1. タイトル　　　　　　　　　　　　　：ホーム画面遷移ボタン
 2. プロジェクト名　　　　　　　　　　：ワークフロー編集中のプロジェクト名
 3. 状態表示エリア　　　　　　　　　　：プロジェクトのstate（実行状態）表示
 4. 編集日時表示エリア　　　　　　　　：プロジェクトの作成、更新日時
 5. ワークフロー画面切替ボタン　　　　：グラフビュー、リストビュー、テキストエディタの切替ボタン
 6. プロジェクト操作ボタンエリア　　　：プロジェクトの実行、停止、クリーンボタン
 7. プロジェクト編集ボタンエリア　　　：プロジェクトの保存、変更の破棄ボタン
 8. 階層表示・遷移ボタン　　　　　　　：現在表示中のプロジェクトディレクトリの階層表示
 9. 環境変数エディタ表示ボタン　　　　：ワークフロー作成用のライブラリ表示用ボタン
10. コンポーネントライブラリ　　　　　：ワークフローの構成要素であるコンポーネントを追加するためのパレット
11. ログ表示ボタン　　　　　　　　　　：ワークフローの作成、実行に関するログ表示用ボタン

次に各エリア、ボタンの詳細について説明します。

### 状態表示エリア
状態表示エリアは、プロジェクト全体の進行状態によって以下の状態を示します。

1. not-started：プロジェクト実行前

![img](./img/not-started.png "not_started")

2. running    ：プロジェクト実行中

![img](./img/running.png "running")

3. finished   ：プロジェクト終了(正常終了)

![img](./img/finished.png "finished")

4. failed     ：プロジェクト終了(エラー発生)

![img](./img/failed.png "failed")

5. holding     : 投入済ジョブ確認中

![img](./img/holding.png "holding")

6. unknonw     : プロジェクトの状態不明

![img](./img/unknown.png "unknown")

### 操作ボタンエリア
このエリアには、プロジェクトの実行に関わるボタンが表示されます。

![img](./img/project_control_btn.png "control_button_area")

1. run ボタン：プロジェクトの実行開始
1. stop ボタン：プロジェクトの実行を停止し実行前の状態に戻す
1. clean：プロジェクトの実行中に生成されたファイルなどを削除し、実行開始前の状態に戻す

### 保存ボタンエリア
このエリアには編集したプロジェクトの保存に関わるボタンが表示されます。

![img](./img/project_save.png "save_button_area")

1. save ボタン：プロジェクトを保存する
1. revert ボタン：プロジェクトを直前の保存状態に戻す

WHEELでは、gitを用いたファイル管理を行っております。
グラフビュー画面上での編集内容はサーバサイドのファイルにすぐに反映されますが
SAVEボタンをクリックするまではgitリポジトリには登録されません。
revertボタンをクリックすると最後にコミットしてから後に行なった変更を全て破棄して
リポジトリに最後にコミットした時の状態に戻します

git操作の詳細については開発者向けドキュメント[詳細設計書](../../../doc/design/design.md)をご確認ください。


### 画面表示切替ボタン
初期表示のグラフビュー画面から、listビューおよびテキストエディタ画面へ遷移するためのボタンです

![img](./img/change_view.png "change_view_area")

1. graph view ボタン
2. list view ボタン
3. テキストエディタボタン

テキストエディタへの遷移は、
ファイルの選択状態やプロジェクトの選択状態によって制限されており、
遷移できない時はボタンがクリックできない状態になっています。


### 階層表示・遷移ボタン
ワークフローはコンポーネントの階層構造を持ちますが、
グラフビュー画面では同一階層のコンポーネントしか同時に表示できません。

階層表示部には現在表示中のコンポーネントが、プロジェクトのルートコンポーネントから
どのような階層を降りてきた位置に存在するのか表示します。

![img](./img/breadcrumbs.png "breadcrumbs")

また、階層表示部の左端にある、ツリー表示ボタンをクリックすると
プロジェクト全体の階層構造が表示されます。

![img](./img/component_tree.png "component_tree")

どちらの表示でも、コンポーネントをクリックすると、表示されているコンポーネントに表示が切り替わります。

### 環境変数エディタ表示ボタン
このボタンをクリックすると
プロジェクト内で実行されるシェルスクリプトなどで使える環境変数を
設定するための画面が表示されます。

![img](./img/environment_variables_editor.png "environment_variables_editor")

- name欄に環境変数名、value欄に値を入力して[+]ボタンをクリックすると、新しく環境変数を追加することができます。
- 環境変数、値ともに表示領域をクリックすることで変更することができます。
- 右端に表示されているゴミ箱アイコンをクリックすることで設定済の環境変数を削除できます。

設定を変更した後は、[SAVE] ボタンをクリックすることで変更内容が実際に反映されます。
変更を破棄して終了する場合は [CANCEL] ボタンをクリックしてください。

### ワークフロー作成用エリア
現在表示中のコンポーネントが持つ子コンポーネントが表示されています。
初期状態ではプロジェクトのルートコンポーネントの直接の子コンポーネントが表示されています。

この領域に、コンポーネントライブラリから、ドラッグ&ドロップすることでプロジェクトにコンポーネントを追加します。

表示されているコンポーネントをダブルクリックすることで、
そのコンポーネントの下位コンポーネントを表示するように切り替わります。

上位コンポーネントへの切り替えは、前述の階層表示部またはコンポーネントツリーを使ってください。

表示されているコンポーネントをシングルクリックすると
そのコンポーネントの設定値(プロパティ)を編集する領域が表示されます。

![img](./img/component_property.png "component_property")

1. closeボタン : プロパティ表示を閉じます
2. cleanボタン : コンポーネント(もしあれば下位コンポーネントも)の状態を最新の保存状態に巻き戻します
3. deleteボタン: コンポーネントを削除します
4. 詳細表示ボタン: プロパティの設定項目の表示/非表示をグループ毎に切り替えます

コンポーネントの種類毎にこの領域に表示される内容は異なります。
プロパティへの設定内容は[コンポーネント](../4_component/00_common.md)の章をご参照ください

### ファイル操作エリア
コンポーネントのプロパティを表示した状態で、Filesグループの `4 詳細表示ボタン`を
クリックすると、次のようなファイル操作エリアが表示されます。

![img](./img/file_area.png "file area")

1. ファイル操作ボタン: コンポーネント内のファイル、ディレクトリを操作するボタンです。詳細は後述
2. ファイル表示エリア: コンポーネント内のファイル、ディレクトリをツリー形式で表示します。
3. closeボタン: ファイル操作エリアの表示/非表示を切り替えます。

ファイル表示エリアには、選択中のコンポーネントディレクトリ以下に存在するファイル、ディレクトリのうち、wheelが使うメタデータファイルや、下位コンポーネントのディレクトリ以外のものが表示されます。

ディレクトリおよびディレクトリへのシンボリックリンクの左側に表示されている三角形アイコンをクリックすることで、さらにそのディレクトリ内のファイル等を表示することができます。

ファイルやディレクトリのうち、連番で構成されるもの(例えば、file1, file2, file3といったもの)が
表示対象に含まれている時は、図中の`seq_dir*`や`seq_file*`のような形で1行にまとめて表示されます。

ただし、後述の新規ファイル、ディレクトリ作成機能を用いて連番となるファイル、ディレクトリを作成した場合は1回プロパティ画面を閉じるか、リロードするまで
連番表示ではなく、個別にファイル、ディレクトリが表示されます。
既に連番表示されているファイル、ディレクトリと同じ形式の名前のファイル、ディレクトリを新規に作成した場合も同様です。

これらの行の左側に表示されている三角形アイコンをクリックすると、ディレクトリと同じような形で元の連番ファイル/ディレクトリが個々に表示されます。

ファイル表示エリアにファイルをドロップすると、コンポーネントディレクトリの直下にファイルをアップロードすることができます。

#### ファイル操作ボタン
ファイル操作エリア上部には、ファイルの操作を行うためのボタンが並んで表示されています。

![img](./img/file_area_button.png "file area button")

1. 新規ディレクトリ作成: 表示されている階層に新規ディレクトリを作成します。
2. 新規ファイル作成: 表示されている階層に新規の空ファイルを作成します
3. リネーム: 選択中のファイル、ディレクトリ等をリネームします。
4. 削除: 選択中のファイル、ディレクトリ等を削除します。
5. アップロード: 表示されている階層にファイルをアップロードします。
6. ダウンロード: 選択中のファイル、ディレクトリをダウンロードします
7. 共有: 選択中のファイル、ディレクトリのパスを表示します。

選択中のファイル、ディレクトリを対象とする操作は、非対応の時はボタンが無効化されます。

共有ボタンをクリックすると、次のようなダイアログが表示されます。

![img](./img/share_file.png "share file dialogue")

表示されているパスの右にあるアイコンをクリックすると、クリップボードにコピーされるので
別のアプリへファイルを渡す時などにお使いください。

例えば、jupyterlabであれば、`http(s)://<server:port>/<lab-location>/lab/tree/path/to/notebook.ipynb` といった形式で指定したipynbファイルを開くことができます。ただし、WHEELからコピーされるファイルは絶対パスですが、ここで指定するパス(`path/to/notebook.ipynb`)はワークスペースのrootからの相対パスである必要があります。
詳細は、jupyterlabのドキュメントをご参照ください。

[File Navigation with tree](https://jupyterlab.readthedocs.io/en/stable/user/urls.html)


### ログ表示ボタン
ワークフローの作成時や実行時等に出力されるログを表示します。

ボタンをクリックすると、次のようなログ表示エリアが表れます。

![img](./img/log_screen.png "log_screen")

ログ表示は内容に応じて複数のタブにそれぞれ出力されます。

1. Info：エラー、ワーニングなどの重大な情報と、プロジェクトの実行状況や操作に関する一般的な情報
1. Stdout：ローカルホストで実行されたtaskの標準出力
1. Stderr：ローカルホストで実行されたtaskの標準エラー出力
1. Stdout(SSH)：リモートホストで実行されたtaskの標準出力
1. Stderr(SSH)：リモートホストで実行されたtaskの標準エラー出力

ラベルの色は次の意味を現わします。
- 青: 現在表示中
- 緑: 新規情報があり、未表示
- 灰: 非表示中

[CLEAR ALL LOG] ボタンをクリックすると、それまでに表示された全てのログが消去されます。

最上部の△ボタンをクリックするとログ表示部が下部に折り畳まれます。


--------
[リファレンスマニュアルのトップページに戻る](../index.md)
